---
layout: post
title: El parche milagroso de Mike Galbraith en acción
date: 2010-11-22
author: neoranger
comments: true
categories: [General]
---
<span class="Apple-style-span" style="color:#333333;font-family:Georgia, 'Bitstream Charter', serif;line-height:24px;"></span><br /><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;"><b>Noticia sacada de <span class="Apple-style-span" style="color:#666666;font-family:'Helvetica Neue', Arial, Helvetica, 'Nimbus Sans L', sans-serif;line-height:36px;"><a href="http://phenobarbital.wordpress.com/" rel="home" style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;color:black;text-decoration:none;vertical-align:baseline;border-width:0;margin:0;padding:0;" title="Phenobarbital con Soda!">Phenobarbital con Soda!</a></span></b></div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">En la página de <a href="http://www.phoronix.com/scan.php?page=article&amp;item=linux_2637_video&amp;num=1" style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;color:#0066cc;vertical-align:baseline;border-width:0;margin:0;padding:0;" target="_blank">Phoronix</a> esta mañana leí un artículo sobre un “fascinante parche” para el kernel Linux que permite agregar “grupos de tareas” para una mejor respuesta del kernel ante eventos, haciendo que aplicaciones de escritorio sean agrupadas por TTY aumentando la interactividad del escritorio en alta carga.</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">La noticia fué replicada por la gente de muyLinux bajo el nombre de “<a href="http://www.muylinux.com/2010/11/16/el-milagro-de-las-200-lineas-de-codigo" style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;color:#0066cc;vertical-align:baseline;border-width:0;margin:0;padding:0;">El milagro de las 200 líneas de código</a>” …</div><h2 style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;clear:both;color:black;font-size:16px;font-weight:normal;vertical-align:baseline;border-width:0;margin:0 0 20px;padding:0;">El parche …</h2><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Este parche fué creado por <a href="http://marc.info/?l=linux-kernel&amp;m=128978361700898&amp;w=2" style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;color:#0066cc;vertical-align:baseline;border-width:0;margin:0;padding:0;">Mike Galbraith</a>, un eterno colaborador del Kernel Linux (nick: efault) y su finalidad principal es otorgar la posibilidad de “agrupar tareas” en las TTY para que el CPU pueda “procesar en lote” todo ese grupo de tareas de una manera más rápida, aprovechando el procesamiento “en paralelo” *casí* todas las tareas relativas al uso de escritorio (sobre todo en el rendering de video) se ven beneficiadas.</div><h2 style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;clear:both;color:black;font-size:16px;font-weight:normal;vertical-align:baseline;border-width:0;margin:0 0 20px;padding:0;">¿Cómo funciona?</h2><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Cuando una tarea se ejecuta, esta genera un “GROUP” de manera automática donde todos los childs (hijos) comparten el “task group” y este un único tty. El parche de hecho es una “prueba de concepto” de una idea que Linus Torvalds había propuesto sobre el comportamiento de los task groups y queda abierta a mejoras de todo tipo.</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Para ser una prueba de concepto (sólo 200 líneas de código) se desempeña bastante bien.</div><h2 style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;clear:both;color:black;font-size:16px;font-weight:normal;vertical-align:baseline;border-width:0;margin:0 0 20px;padding:0;">¿Dónde y cómo implementarlo?</h2><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">El parche aún se encuentra en pruebas y no ha sido empaquetado en ningún lado, se encuentra como respuesta a un <a href="http://marc.info/?l=linux-kernel&amp;m=128978361700898&amp;w=2" style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;color:#0066cc;vertical-align:baseline;border-width:0;margin:0;padding:0;">correo de discusión de Linus Torvalds acá</a>, y sólo puede ser implementado en kernels donde la gestión de carga de trabajo de las TTY existe (&gt; 2.6.37), yo he descargado y copiado el parche acá:</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;"><a href="http://anyhub.net/file/W_n-rfc-rft-v3-sched-automated-per-tty-task-groups.patch.tar.bz2" style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;color:#0066cc;vertical-align:baseline;border-width:0;margin:0;padding:0;">http://anyhub.net/file/W_n-rfc-rft-v3-sched-automated-per-tty-task-groups.patch.tar.bz2</a></div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">De donde lo pueden bajar limpio y sin inconvenientes.</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">He descargado el kernel 2.6.37-rc2 de la página de kernel.org, lo descomprimo para compilarlo “de la manera habitual”, sin embargo:</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Ejecutamos:</div><pre style="background-attachment:initial;background-clip:initial;background-color:#f7f7f7;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;color:#222222;font-family:'Courier 10 Pitch', Courier, monospace;font-size:15px;line-height:21px;vertical-align:baseline;border-width:0;margin:0 0 24px;">make mrproper</pre><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Y la copia de las opciones “por defecto”</div><pre style="background-attachment:initial;background-clip:initial;background-color:#f7f7f7;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;color:#222222;font-family:'Courier 10 Pitch', Courier, monospace;font-size:15px;line-height:21px;vertical-align:baseline;border-width:0;margin:0 0 24px;">make oldconfig</pre><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Ahora aplicaremos el kernel, para ello lo descomprimimos en la raíz de /usr/src, nos movemos a la carpeta del kernel:</div><pre style="background-attachment:initial;background-clip:initial;background-color:#f7f7f7;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;color:#222222;font-family:'Courier 10 Pitch', Courier, monospace;font-size:15px;line-height:21px;vertical-align:baseline;border-width:0;margin:0 0 24px;">cd linux-2.6.37-rc2/</pre><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Y ejecutamos el parche:</div><pre style="background-attachment:initial;background-clip:initial;background-color:#f7f7f7;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;color:#222222;font-family:'Courier 10 Pitch', Courier, monospace;font-size:15px;line-height:21px;vertical-align:baseline;border-width:0;margin:0 0 24px;">patch -p1 --dry-run &lt; ../RFC-RFT-v3-sched-automated-per-tty-task-groups.patch<br /></pre><h2 style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;clear:both;color:black;font-size:16px;font-weight:normal;vertical-align:baseline;border-width:0;margin:0 0 20px;padding:0;">Opciones habilitadas en el Kernel:</h2><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Ejecutando <em style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;font-style:italic;vertical-align:baseline;border-width:0;margin:0;padding:0;">make menuconfig</em> o <em style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;font-style:italic;vertical-align:baseline;border-width:0;margin:0;padding:0;">make gconfig</em> (si están en gnome) activaremos las siguientes opciones del Kernel Linux:</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">En “General Setup”:</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">Kernel compression mode:<br />LZO (el más rápido en descomprimir)</address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Para que el kernel se descomprima rápidamente pueden activar el modo de compresión LZO, pero requieren instalar el siguiente paquete:</div><pre style="background-attachment:initial;background-clip:initial;background-color:#f7f7f7;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;color:#222222;font-family:'Courier 10 Pitch', Courier, monospace;font-size:15px;line-height:21px;vertical-align:baseline;border-width:0;margin:0 0 24px;">aptitude install lzop</pre><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">Enable Block Layer &gt; IO Schedulers &gt; CFQ I/O Scheduler &gt; CONFIG_CFQ_GROUP_IOSCHED</address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Esto habilita el I/O scheduler por grupos (CFQ_GROUP_IOSCHED)</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">Control Group Support (CONFIG_CGROUPS):<br />Namespace cgroup subsystemFreezer cgroup subsystemDevice Controller for cgroups<br />CPUset support &gt; include legacy</address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Precisamente la opción que incorpora el parche, los CGROUPS y su control.</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">Resource counters &gt; Memory Resource controller &gt; MRC for Swap Extension</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">Group CPU Scheduler (CONFIG_CGROUP_SCHED)<br />Group Scheduling for SCHED_OTHER<br />Group Scheduling for SCHED_RR/FIFO</address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Con esto, habilitamos todos los tipos de sheduler basado en grupos.</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">Block IO Controller<br />Default I/O scheduler<br />CFQ</address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Opciones que colaboran con el parche.</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">Processor type and features &gt; Preemption Model &gt; Preemptible Kernel (low-latency desktop)</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;"></address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Requerido, para que podamos contar con un kernel Preemtivo. (de baja latencia).</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">MTRR support &gt; MTRR Cleanup support<br />Timer Frequency &gt; 1000 Hz</address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Otras opciones que colaboran con el performance del kernel Linux.</div><h2 style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;clear:both;color:black;font-size:16px;font-weight:normal;vertical-align:baseline;border-width:0;margin:0 0 20px;padding:0;">Compilando</h2><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Compilamos de la manera usual:</div><ul style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;list-style-image:initial;list-style-position:initial;list-style-type:square;margin-bottom:24px;margin-right:0;margin-top:0;vertical-align:baseline;border-width:0;padding:0;"><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">make all</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">make modules</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">make modules install</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">make install</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">mkinitramfs -o /boot/initrd.img-2.6.37-rc2-amd64 /lib/modules/2.6.37-rc2-amd64</li></ul><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Y actualizamos nuestro grub para que agregue la entrada del kernel:</div><pre style="background-attachment:initial;background-clip:initial;background-color:#f7f7f7;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;color:#222222;font-family:'Courier 10 Pitch', Courier, monospace;font-size:15px;line-height:21px;vertical-align:baseline;border-width:0;margin:0 0 24px;">update-grub2</pre><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">y Listo, ahora, a probar el kernel.</div><h2 style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;clear:both;color:black;font-size:16px;font-weight:normal;vertical-align:baseline;border-width:0;margin:0 0 20px;padding:0;">Pruebas</h2><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Aun cuando hay pruebas más especializadas (como el interbench diseñado por Con Kolivas) yo he hecho una simple prueba (repetible por cualquiera) y que demuestra los beneficios directos del tunning; en este caso, he comprobado con 3 Kernel Linux y diversos modos.</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Como nota adicional, mi equipo es:</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">Linux lexotanil 2.6.37-rc2amd64 #2 SMP PREEMPT Tue Nov 16 16:32:42 VET 2010 x86_64 GNU/Linux</address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Es un Debian Squeeze, tiene servicios cargados (openldap, postgresql, mysql) y utilidades de escritorio (compiz-fusion, gnome-applets, metacity como gestor, rendering habilitado según guía en este mismo blog) por lo que este parche *podría* en teoría, ser muchisimo más beneficioso para gente con equipos basados en distribuciones Desktop (Ubuntu, Trisquel), que mi equipo que es un servidor, sin embargo, el incremento de rendimiento fue brutal!.</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">A este equipo se le han realizado los siguientes cambios, con el fin de mejorar su performance:</div><ul style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;list-style-image:initial;list-style-position:initial;list-style-type:square;margin-bottom:24px;margin-right:0;margin-top:0;vertical-align:baseline;border-width:0;padding:0;"><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;"><a href="http://phenobarbital.wordpress.com/2010/08/23/linux-mtrr-allocation-failed-mejora-de-performance-del-video-intel/" style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;color:#0066cc;vertical-align:baseline;border-width:0;margin:0;padding:0;">corrección del bug de MTRR</a></li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;"><a href="http://phenobarbital.wordpress.com/2010/08/23/linux-video-mejorando-la-aceleracion-de-video/" style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;color:#0066cc;vertical-align:baseline;border-width:0;margin:0;padding:0;">Activación de la aceleración 3D y el direct-rendering de la Intel 965</a></li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;"><a href="http://phenobarbital.wordpress.com/2010/08/06/de-lenny-a-squeeze-cambios-en-la-configuracion-de-video-intel/" style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;color:#0066cc;vertical-align:baseline;border-width:0;margin:0;padding:0;">Re-configuración del Xorg para squeeze</a></li></ul><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">En la primera prueba, se probó en un Kernel “genérico Debian” sin ninguna modificación al equipo:</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Kernel genérico, sin 3D ni MTRR:</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">glxgears -info</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_RENDERER   = Software Rasterizer</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_VERSION    = 2.1 Mesa 7.7.1</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_VENDOR     = Mesa Project</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">1494 frames in 5.0 seconds = 298.796 FPS</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">1582 frames in 5.0 seconds = 316.213 FPS</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">1616 frames in 5.0 seconds = 323.090 FPS</address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Los tiempos en promedio, son unos 300 FPS.</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Kernel genérico, sin aceleración 3D (pero corrección MTRR activa):</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">glxgears -info</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_RENDERER   = Software Rasterizer</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_VERSION    = 2.1 Mesa 7.7.1</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_VENDOR     = Mesa Project</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">2277 frames in 5.0 seconds = 455.288FPS</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">2314 frames in 5.0 seconds = 462.779 FPS</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">2251 frames in 5.0 seconds = 450.191 FPS</address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Mismo kernel, pero con el MTRR corregido (mejora del 10%).</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">Con aceleración 3D, sin parche de Mike:<br />glxgears -info</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_RENDERER   = Mesa DRI Intel(R) 965GM GEM 20091221 2009Q4</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_VERSION    = 2.1 Mesa 7.7.1</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_VENDOR     = Tungsten Graphics, Inc</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">3618 frames in 5.0 seconds = 723.600 FPS</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">3448 frames in 5.0 seconds = 689.600 FPS</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">3511 frames in 5.0 seconds = 702.200 FPS</address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Con 3D y MTRR corregido, el rendimiento en el kernel “genérico” es notable (promedio: 700 FPS).</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Kernel con parche realtime (RT Linux): 2.6.33.7-rt29-amd64</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_RENDERER   = Mesa DRI Intel(R) 965GM GEM 20091221 2009Q4</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_VERSION    = 2.1 Mesa 7.7.1</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_VENDOR     = Tungsten Graphics, Inc</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">3418 frames in 5.0 seconds = 683.600 FPS</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">3483 frames in 5.0 seconds = 696.600 FPS</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">3498 frames in 5.0 seconds = 699.460 FPS</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;"></address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Este Kernel (2.6.33-7 con parche RT de <a href="https://rt.wiki.kernel.org/index.php/Main_Page" style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;color:#0066cc;vertical-align:baseline;border-width:0;margin:0;padding:0;">RT-Linux</a>) lo uso para transmitir por radioGNU en modo tiempo-real.</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Parche de Mike Galbraith; Kernel 2.6.37-rc2-amd64 con parche:</div><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">glxgears -info</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_RENDERER   = Mesa DRI Intel(R) 965GM GEM 20091221 2009Q4</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_VERSION    = 2.1 Mesa 7.7.1</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">GL_VENDOR     = Tungsten Graphics, Inc</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">5707 frames in 5.0 seconds = 1141.172 FPS</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">6153 frames in 5.0 seconds = 1230.600 FPS</address><address style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0;padding:0;">6280 frames in 5.0 seconds = 1255.749 FPS</address><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Como vemos, este parche incrementa en más del 70% la respuesta del Kernel a eventos como dibujado de pantalla, scroll, renderizado de video, etc.</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Un screenshot acá:</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;"><a href="http://phenobarbital.files.wordpress.com/2010/11/totalidad.png" style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;color:#0066cc;vertical-align:baseline;border-width:0;margin:0;padding:0;"><img alt="" class="alignnone size-full wp-image-1301" height="480" src="http://phenobarbital.files.wordpress.com/2010/11/totalidad.png?w=640&amp;h=480" title="totalidad" width="640" /></a></div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">En el screenshot se ve:</div><ul style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;list-style-image:initial;list-style-position:initial;list-style-type:square;margin-bottom:24px;margin-right:0;margin-top:0;vertical-align:baseline;border-width:0;padding:0;"><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">Chromium browser: con un video de youtube y otro con el FishIE Tank de HTML5</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">Firefox con unas 15 pestañas abiertas</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">Icedove con mis 3 buzones IMAP abiertos</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">GLXGears</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">Mplayer mostrando otro video</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">Una consola de gnome-terminal con 5 pestañas</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">un editor de texto (mi bitácora)</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">Gnome con Compiz-Fusion activado</li><li style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;background-position:initial initial;background-repeat:initial initial;border-color:initial;border-style:initial;vertical-align:baseline;border-width:0;margin:0;padding:0;">Varias ventanas de nautilus</li></ul><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Como verán, la respuesta del kernel nunca fué poner el CPU en on-demand (1.6 Ghz) no fué necesario, ya que la carga paralelizada en Debian hizo que el CPU nunca llegara a más del 90% de su carga.</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Nota: no hagan caso de la temperatura, vivo en la ciudad de Barquisimeto y hoy fué un día extremadamente caluroso (por encima de 32 grados centígrados). =P</div><h2 style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;clear:both;color:black;font-size:16px;font-weight:normal;vertical-align:baseline;border-width:0;margin:0 0 20px;padding:0;">Conclusiones</h2><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Hice pruebas y benchmarks también con el interbench de Con Kolivas, que aunque confirman los resultados acá expuestos, sería muy largo explicar el test cuando un glxgears reportaría iguales resultados (una mejora notable en la respuesta del equipo).</div><div style="background-attachment:initial;background-clip:initial;background-color:transparent;background-image:initial;background-origin:initial;border-color:initial;border-style:initial;font-size:16px;vertical-align:baseline;border-width:0;margin:0 0 24px;padding:0;">Espero hagan sus propias pruebas y permitan dar por sentado que este parche representa el futuro del alto rendimiento en Linux PREEMPT para usuarios comunes y corrientes de escritorio</div>
